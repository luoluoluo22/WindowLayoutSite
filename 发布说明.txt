【动作名称】
灵动窗口布局

【简介】
一键智能自动排列窗口，独创可视化拖拽锁定与位置记忆，支持场景快照一键恢复工作环境，工作流效率神器。

【关键词】
窗口;布局;分屏;整理;记忆;自动排列;对齐;强迫症;场景;快照;恢复

【开发背景】
平时工作时，桌面上总是堆满了各种窗口（VS Code、浏览器、微信、文件夹），手动一个个拖拽对齐太浪费生命了，系统自带的分屏又不够灵活。
最让我头疼的是，我希望把某些核心窗口（比如编辑器）固定在特定位置和特定大小，雷打不动；而把其他辅助窗口自动填补到剩下的空位里。
为了解决这个痛点，我开发了这个"灵动窗口布局"。它最强的地方在于**"可视化锁定"**——你可以像贴便利贴一样把窗口钉在屏幕上，下次运行动作时，它依然会在老地方等你，其他杂鱼窗口则会自动乖乖排队补位。

【使用说明】
1. **一键布局**：运行动作，所有可见窗口将根据算法自动平铺，最大化利用屏幕空间。
2. **可视化控制**：布局后进入"调整模式"，屏幕中央出现控制球，每个窗口左上角显示状态锁和拖拽手柄。
3. **锁定/解锁**：点击窗口左上角的 🔓/🔒 图标即可锁定。**锁定后，系统会永久记忆该程序的位置和大小**。
4. **拖拽交换**：拖动锁图标旁边的 ⋮ 手柄到另一个窗口的手柄上，两个窗口会**立即交换位置**。
5. **拖拽即记忆**：直接拖动或调整已锁定的窗口，锁图标会实时跟随，新位置即刻自动保存，所见即所得。
6. **智能刷新**：点击屏幕中央的 **↻** 按钮，重新洗牌排列"未锁定"窗口，它们会智能避开锁定区域并填补空缺。
7. **身份识别**：鼠标悬停在锁图标上，可查看该窗口的详细标题和进程名，精准管理。
8. **退出**：点击屏幕中央的 **✔** 按钮结束调整。

【场景快照功能】（全新！）
1. **保存场景**：点击屏幕中央的 **📸** 按钮，将当前所有窗口的布局保存为一个"场景快照"。
2. **场景画廊**：再次点击 📸 按钮，打开沉浸式场景画廊，可视化预览所有已保存的场景缩略图。
3. **一键恢复**：在画廊中点击任意场景卡片，系统将：
   - 自动匹配并移动已存在的窗口到记忆位置
   - 缺失的程序会**自动启动并延迟归位**
   - 浏览器窗口会恢复到保存时的 **URL 页面**
   - 资源管理器窗口会打开到保存时的 **文件夹路径**
4. **场景管理**：在画廊中右键可删除单个场景或清空所有场景。

【技术亮点】
*   **无感刷新**：采用瞬隐技术，布局调整丝滑无黑屏闪烁。
*   **阴影补偿算法**：完美解决 Win10/11 窗口因阴影导致的"反复运行变小"问题，像素级精准还原。
*   **智能槽位合并**：窗口不够填满格子时，最后一个窗口会自动拉伸覆盖剩余空位，拒绝死板留白。
*   **幽灵过滤**：自动屏蔽 Quicker 自身弹窗、PixPin 截图/贴图及系统后台干扰窗口。
*   **浏览器 URL 感知**：使用 UI Automation 技术精准抓取浏览器地址栏 URL，场景恢复精准定位网页。
*   **资源管理器路径感知**：使用 Shell COM 接口获取文件夹路径，准确恢复到具体目录。
*   **拖拽交换**：支持窗口之间快速交换位置，无需手动调整。

【更新日志】
v2.0 (2026-01-03)
- 🎉 新增场景快照功能：一键保存/恢复多窗口工作环境
- 🖼️ 新增沉浸式场景画廊：可视化缩略图预览
- 🚀 新增自动拉起缺失程序并延迟归位
- 🌐 新增浏览器 URL 恢复（支持 Edge/Chrome）
- 📁 新增资源管理器文件夹路径恢复
- ↔️ 新增拖拽交换位置功能
- 📸 场景名称精确到秒级，避免同名覆盖
- 🔧 优化场景画廊删除后即时刷新

v1.0 (初始版本)
- 智能窗口布局
- 可视化锁定
- 位置记忆
- 黑名单管理
